<div
  class="min-h-screen flex items-center justify-center bg-secondary-50 dark:bg-dark-900 py-12 px-4 sm:px-6 lg:px-8"
>
  <div class="max-w-4xl w-full space-y-8">
    <!-- Header -->
    <div class="text-center">
      <h1 class="text-3xl font-bold text-secondary-900 dark:text-secondary-100">
        {{ 'AUTH.RFQ_SYSTEM' | translate }}
      </h1>
      <h2
        class="mt-6 text-2xl font-semibold text-secondary-800 dark:text-secondary-200"
      >
        {{ currentStep === 'basic' ? ('AUTH.CREATE_YOUR_ACCOUNT' | translate) :
        currentStep === 'vendor' ? ('AUTH.COMPANY_INFORMATION' | translate) :
        currentStep === 'location' ? ('AUTH.LOCATION_AND_CATEGORIES' |
        translate) : ('AUTH.CREATE_YOUR_ACCOUNT' | translate) }}
      </h2>
      <p class="mt-2 text-sm text-secondary-600 dark:text-secondary-400">
        {{ message }}
      </p>
    </div>

    <!-- Success Message -->
    <div
      *ngIf="successMessage"
      class="alert alert-success fade-in"
      role="alert"
    >
      <div class="flex">
        <svg class="h-5 w-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
          <path
            fill-rule="evenodd"
            d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"
            clip-rule="evenodd"
          />
        </svg>
        <span>{{ successMessage }}</span>
      </div>
    </div>

    <!-- Signup Form -->
    <form
      class="mt-8 space-y-6 flex flex-col items-center"
      [formGroup]="signupForm"
    >
      <!-- Error Message -->
      <div *ngIf="errorMessage" class="alert alert-error fade-in" role="alert">
        <div class="flex">
          <svg class="h-5 w-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
            <path
              fill-rule="evenodd"
              d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z"
              clip-rule="evenodd"
            />
          </svg>
          <span>{{ errorMessage }}</span>
        </div>
      </div>

      <!-- Step 1: Basic User Information -->
      <div *ngIf="currentStep === 'basic'" class="max-w-md space-y-3">
        <!-- Name Fields -->
        <div class="grid grid-cols-1 gap-4 sm:grid-cols-2">
          <!-- First Name -->
          <div>
            <label for="firstName" class="form-label"
              >{{ 'AUTH.FIRST_NAME' | translate }}
            </label>
            <input
              type="text"
              autocomplete="given-name"
              formControlName="firstName"
              class="form-input"
              [class.border-error-500]="isFieldInvalid('firstName')"
              placeholder="{{ 'AUTH.ENTER_FIRST_NAME' | translate }}"
            />
            <div *ngIf="isFieldInvalid('firstName')" class="form-error">
              {{ getFieldError('firstName') }}
            </div>
          </div>
          <!-- Last Name -->
          <div>
            <label for="lastName" class="form-label"
              >{{ 'AUTH.LAST_NAME' | translate }}
            </label>
            <input
              type="text"
              autocomplete="family-name"
              formControlName="lastName"
              class="form-input"
              [class.border-error-500]="isFieldInvalid('lastName')"
              placeholder="{{ 'AUTH.ENTER_LAST_NAME' | translate }}"
            />
            <div *ngIf="isFieldInvalid('lastName')" class="form-error">
              {{ getFieldError('lastName') }}
            </div>
          </div>
        </div>
        <!-- Email Field -->
        <div>
          <label for="email" class="form-label"
            >{{'AUTH.EMAIL' | translate}}</label
          >
          <div class="relative">
            <input
              type="email"
              autocomplete="email"
              formControlName="email"
              class="form-input"
              [class.border-error-500]="isFieldInvalid('email')"
              placeholder="{{ 'AUTH.ENTER_EMAIL' | translate }}"
            />
            <div class="absolute inset-y-0 right-0 pr-3 flex items-center">
              <svg
                *ngIf="!isFieldInvalid('email')"
                class="h-5 w-5 text-secondary-400"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M16 12a4 4 0 10-8 0 4 4 0 008 0zm0 0v1.5a2.5 2.5 0 005 0V12a9 9 0 10-9 9m4.5-1.206a8.959 8.959 0 01-4.5 1.207"
                />
              </svg>
              <svg
                *ngIf="isFieldInvalid('email')"
                class="h-5 w-5 text-error-500"
                fill="currentColor"
                viewBox="0 0 20 20"
              >
                <path
                  fill-rule="evenodd"
                  d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z"
                  clip-rule="evenodd"
                />
              </svg>
            </div>
          </div>
          <div *ngIf="isFieldInvalid('email')" class="form-error">
            {{ getFieldError('email') }}
          </div>
        </div>
        <!-- Role Selection -->
        <div>
          <label for="role" class="form-label"
            >{{ 'AUTH.ACCOUNT_TYPE' | translate }} *</label
          >
          <select
            formControlName="role"
            class="form-select"
            [class.border-error-500]="isFieldInvalid('role')"
            (change)="onRoleChange()"
          >
            <option value="" disabled>
              {{ 'AUTH.SELECT_YOUR_ROLE' | translate }}
            </option>
            <option *ngFor="let role of userRoles" [value]="role.name">
              {{ role.name }}
            </option>
          </select>
          <div *ngIf="isFieldInvalid('role')" class="form-error">
            {{ getFieldError('role') }}
          </div>
        </div>
        <!-- Password Field -->
        <div>
          <label for="password" class="form-label"
            >{{ 'AUTH.PASSWORD' | translate }} *</label
          >
          <div class="relative">
            <input
              [type]="showPassword ? 'text' : 'password'"
              autocomplete="new-password"
              formControlName="password"
              class="form-input"
              [class.border-error-500]="isFieldInvalid('password')"
              placeholder="{{ 'AUTH.CREATE_STRONG_PASSWORD' | translate }}"
            />
            <button
              type="button"
              (click)="togglePasswordVisibility()"
              class="absolute inset-y-0 right-0 pr-3 flex items-center"
            >
              <svg
                *ngIf="!showPassword"
                class="h-5 w-5 text-secondary-400 hover:text-secondary-600"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"
                />
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"
                />
              </svg>
              <svg
                *ngIf="showPassword"
                class="h-5 w-5 text-secondary-400 hover:text-secondary-600"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.878 9.878L3 3m6.878 6.878L21 21"
                />
              </svg>
            </button>
          </div>
          <!-- Password Strength Indicator -->
          <div *ngIf="signupForm.get('password')?.value" class="mt-2">
            <div class="flex items-center space-x-2">
              <div class="flex space-x-1">
                <div
                  class="h-1 w-8 rounded-full transition-colors duration-200"
                  [class]="getPasswordStrength() === 'weak' ? 'bg-error-500' :
                          getPasswordStrength() === 'medium' ? 'bg-warning-500' : 'bg-success-500'"
                ></div>
                <div
                  class="h-1 w-8 rounded-full transition-colors duration-200"
                  [class]="getPasswordStrength() === 'medium' ? 'bg-warning-500' :
                          getPasswordStrength() === 'strong' ? 'bg-success-500' : 'bg-secondary-200 dark:bg-secondary-700'"
                ></div>
                <div
                  class="h-1 w-8 rounded-full transition-colors duration-200"
                  [class]="getPasswordStrength() === 'strong' ? 'bg-success-500' : 'bg-secondary-200 dark:bg-secondary-700'"
                ></div>
              </div>
              <span
                class="text-xs font-medium capitalize"
                [class]="getPasswordStrength() === 'weak' ? 'text-error-600 dark:text-error-400' :
                        getPasswordStrength() === 'medium' ? 'text-warning-600 dark:text-warning-400' :
                        'text-success-600 dark:text-success-400'"
              >
                {{ getPasswordStrength() }}
              </span>
            </div>
          </div>
          <div *ngIf="isFieldInvalid('password')" class="form-error">
            {{ getFieldError('password') }}
          </div>
        </div>
        <!-- Confirm Password Field -->
        <div>
          <label for="confirmPassword" class="form-label">
            {{ 'AUTH.CONFIRM_PASSWORD' | translate }} *
          </label>
          <div class="relative">
            <input
              [type]="showConfirmPassword ? 'text' : 'password'"
              autocomplete="new-password"
              formControlName="confirmPassword"
              class="form-input"
              [class.border-error-500]="isFieldInvalid('confirmPassword')"
              placeholder="{{ 'AUTH.CONFIRM_YOUR_PASSWORD' | translate }}"
            />
            <button
              type="button"
              (click)="toggleConfirmPasswordVisibility()"
              class="absolute inset-y-0 right-0 pr-3 flex items-center"
            >
              <svg
                *ngIf="!showConfirmPassword"
                class="h-5 w-5 text-secondary-400 hover:text-secondary-600"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"
                />
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"
                />
              </svg>
              <svg
                *ngIf="showConfirmPassword"
                class="h-5 w-5 text-secondary-400 hover:text-secondary-600"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.878 9.878L3 3m6.878 6.878L21 21"
                />
              </svg>
            </button>
          </div>
          <div *ngIf="isFieldInvalid('confirmPassword')" class="form-error">
            {{ getFieldError('confirmPassword') }}
          </div>
        </div>
      </div>

      <!-- Step 2: Vendor Details (only shown for vendors) -->
      <div *ngIf="currentStep === 'vendor'" class="space-y-6 max-w-md w-full">
        <!-- Back Button -->
        <div class="flex justify-start">
          <button
            type="button"
            (click)="goBackToBasicInfo()"
            class="flex items-center text-sm text-secondary-600 hover:text-secondary-800 dark:text-secondary-400 dark:hover:text-secondary-200"
          >
            <svg
              class="h-4 w-4 mr-1"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M15 19l-7-7 7-7"
              />
            </svg>
            {{ 'AUTH.BACK_TO_ACCOUNT_DETAILS' | translate }}
          </button>
        </div>
        <div class="grid grid-cols-1 gap-8">
          <!-- Left Column - Company Details -->
          <div class="space-y-3">
            <!-- Company Name -->
            <div>
              <label for="CompanyName" class="form-label"
                >{{ 'AUTH.COMPANY_NAME' | translate }} *</label
              >
              <input
                type="text"
                formControlName="name"
                class="form-input"
                [class.border-error-500]="isFieldInvalid('name')"
                placeholder="{{ 'AUTH.ENTER_COMPANY_NAME' | translate }}"
              />
              <div *ngIf="isFieldInvalid('name')" class="form-error">
                {{ getFieldError('name') }}
              </div>
            </div>
            <!-- Contact Person -->
            <div>
              <label for="contactPersonFirstName" class="form-label">
                {{ 'AUTH.CONTACT_PERSON_FIRST_NAME' | translate }} *
              </label>
              <input
                type="text"
                formControlName="contactPersonFirstName"
                class="form-input"
                [class.border-error-500]="isFieldInvalid('contactPersonFirstName')"
                placeholder="{{ 'AUTH.ENTER_CONTACT_PERSON_FIRST_NAME' | translate }}"
              />
              <div
                *ngIf="isFieldInvalid('contactPersonFirstName')"
                class="form-error"
              >
                {{ getFieldError('contactPersonFirstName') }}
              </div>
            </div>
            <!-- Contact Person Last Name -->
            <div>
              <label for="contactPersonLastName" class="form-label">
                {{ 'AUTH.CONTACT_PERSON_LAST_NAME' | translate }} *
              </label>
              <input
                type="text"
                formControlName="contactPersonLastName"
                class="form-input"
                [class.border-error-500]="isFieldInvalid('contactPersonLastName')"
                placeholder="{{ 'AUTH.ENTER_CONTACT_PERSON_LAST_NAME' | translate }}"
              />
              <div
                *ngIf="isFieldInvalid('contactPersonLastName')"
                class="form-error"
              >
                {{ getFieldError('contactPersonLastName') }}
              </div>
            </div>
            <div>
              <label for="phoneNumber" class="form-label">
                {{ 'AUTH.PHONE_NUMBER' | translate }} *
              </label>
              <input
                type="text"
                formControlName="phoneNumber"
                class="form-input"
                [class.border-error-500]="isFieldInvalid('phoneNumber')"
                placeholder="{{ 'AUTH.ENTER_PHONE_NUMBER' | translate }}"
              />
              <div *ngIf="isFieldInvalid('phoneNumber')" class="form-error">
                {{ getFieldError('phoneNumber') }}
              </div>
            </div>
            <!-- Contact Email -->
            <div>
              <label for="contactEmail" class="form-label">
                {{ 'AUTH.CONTACT_EMAIL_OPTIONAL' | translate }}
              </label>
              <input
                type="email"
                formControlName="contactEmail"
                class="form-input"
                placeholder="{{ 'AUTH.ENTER_CONTACT_EMAIL' | translate }}"
              />
              <p class="mt-1 text-xs text-secondary-500">
                {{'AUTH.DEFAULTS_TO_YOUR_EMAIL_IF_NOT_PROVIDED' | translate}}
              </p>
            </div>
            <!-- Contact Phone -->
            <div>
              <label for="contactPhone" class="form-label">
                {{ 'AUTH.CONTACT_PHONE_OPTIONAL' | translate }}
              </label>
              <input
                type="text"
                formControlName="contactPhone"
                class="form-input"
                placeholder="{{ 'AUTH.ENTER_CONTACT_PHONE' | translate }}"
              />
              <p class="mt-1 text-xs text-secondary-500">
                {{ 'AUTH.DEFAULTS_TO_YOUR_PHONE_IF_NOT_PROVIDED' | translate }}
              </p>
            </div>
            <!-- Phone Number -->

            <!-- Business Description -->
            <div>
              <label for="businessDescription" class="form-label">
                {{ 'AUTH.BUSINESS_DESCRIPTION_SPECIALTIES' | translate }} *
              </label>
              <textarea
                rows="4"
                formControlName="businessDescription"
                class="form-input"
                [class.border-error-500]="isFieldInvalid('businessDescription')"
                placeholder="{{ 'AUTH.DESCRIBE_YOUR_BUSINESS_AND_SPECIALTIES' | translate }}"
              ></textarea>
              <div
                *ngIf="isFieldInvalid('businessDescription')"
                class="form-error"
              >
                {{ getFieldError('businessDescription') }}
              </div>
            </div>
            <!-- Company Size -->
            <div>
              <label for="companySize" class="form-label">
                {{ 'AUTH.COMPANY_SIZE_OPTIONAL' | translate }}
              </label>
              <select formControlName="companySize" class="form-select">
                <option value="">
                  {{ 'AUTH.SELECT_COMPANY_SIZE' | translate }}
                </option>
                <option *ngFor="let size of companySizes" [value]="size.id">
                  {{ size.name }}
                </option>
              </select>
            </div>
            <!-- Business License Upload -->
            <div>
              <label for="businessLicense" class="form-label">
                {{ 'AUTH.BUSINESS_LICENSE_CERTIFICATION_OPTIONAL' | translate }}
              </label>
              <input
                formControlName="businessLicense"
                type="file"
                accept=".pdf,.jpg,.jpeg,.png,.doc,.docx"
                (change)="onFileSelected($event)"
                class="form-input file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-primary-50 file:text-primary-700 hover:file:bg-primary-100"
              />
              <p class="mt-1 text-xs text-secondary-500">
                {{ 'AUTH.ACCEPTED_FORMATS' | translate }}: PDF, JPG, PNG, DOC,
                DOCX (Max 5MB)
              </p>
              <div
                *ngIf="selectedFileName"
                class="mt-2 text-sm text-secondary-600"
              >
                {{ 'AUTH.SELECTED' | translate }}: {{ selectedFileName }}
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Step 3: Location and Categories (only for vendors) -->
      <div *ngIf="currentStep === 'location'" class="w-full space-y-6">
        <!-- Back Button -->
        <div class="flex justify-start">
          <button
            type="button"
            (click)="goBackToVendorInfo()"
            class="flex items-center text-sm text-secondary-600 hover:text-secondary-800 dark:text-secondary-400 dark:hover:text-secondary-200"
          >
            <svg
              class="h-4 w-4 mr-1"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M15 19l-7-7 7-7"
              />
            </svg>
            {{ 'AUTH.BACK_TO_COMPANY_INFO' | translate }}
          </button>
        </div>

        <div class="grid grid-cols-1 gap-8">
          <!-- Left side - Service Area -->
          <div>
            <h3
              class="text-lg font-semibold text-secondary-900 dark:text-secondary-100 mb-4"
            >
              {{ 'AUTH.SERVICE_AREA' | translate }}
            </h3>
            <app-service-areas
              (serviceAreaChange)="handleServiceAreaChange($event)"
            ></app-service-areas>
          </div>

          <!-- Right side - Material Categories -->
          <div>
            <h3
              class="text-lg font-semibold text-secondary-900 dark:text-secondary-100 mb-4"
            >
              {{ 'AUTH.MATERIAL_CATEGORIES' | translate }}
            </h3>
            <p class="text-sm text-secondary-600 dark:text-secondary-400 mb-4">
              {{ 'AUTH.SELECT_CATEGORIES_DESCRIPTION' | translate }}
            </p>
            <app-material-categories-selection
              #materialCategoriesComponent
              [isRequestQuote]="true"
            >
            </app-material-categories-selection>
          </div>
        </div>
      </div>

      <!-- Submit Button -->
      <div class="max-w-md">
        <button
          type="submit"
          class="btn btn-primary w-full flex justify-center py-3 px-4"
          [disabled]="isLoading || !isFormValidForCurrentStep()"
          (click)="onSubmit()"
        >
          <span *ngIf="!isLoading">{{ getSubmitButtonText() }}</span>
          <div *ngIf="isLoading" class="flex items-center">
            <div class="spinner mr-2"></div>
            <span>
              {{ currentStep === 'location' ? ('AUTH.CREATING_ACCOUNT' |
              translate) : ('AUTH.PROCESSING' | translate) }}
            </span>
          </div>
        </button>
      </div>
      <!-- Login Link -->
      <div class="text-center">
        <p class="text-sm text-secondary-600 dark:text-secondary-400">
          {{'AUTH.ALREADY_HAVE_ACCOUNT' | translate}}
          <button
            type="button"
            (click)="navigateToLogin(false)"
            class="font-medium text-primary-600 hover:text-primary-500 dark:text-primary-400 dark:hover:text-primary-300 ml-1"
          >
            {{ 'AUTH.SIGN_IN_HERE' | translate }}
          </button>
        </p>
      </div>
    </form>
    <!-- Additional Info -->
    <div class="mt-8 text-center">
      <p class="text-xs text-secondary-500 dark:text-secondary-400">
        {{ 'AUTH.ACCOUNT_REVIEW_INFO' | translate }}
      </p>
    </div>
  </div>
</div>
