<!-- Profile Details Card -->
<div class="bg-white card shadow-md rounded-xl mb-10 dark:bg-dark-900">
  <!-- Card Header -->
  <div class="cursor-pointer px-6 pt-6" role="button">
    <div>
      <h3 class="text-lg font-bold text-gray-900 dark:text-white m-0">
       {{ 'PROFILE.PROFILE_DETAILS' | translate }}
      </h3>
    </div>
  </div>

  <!-- Form -->
  <form class="pt-6" [formGroup]="userForm" (ngSubmit)="onSubmit()">
    <div
      class="border-t border-gray-200 dark:border-dark-700 px-6 py-8 space-y-8"
    >
      <!-- Avatar Upload -->
      <div class="grid grid-cols-1 md:grid-cols-12 items-start gap-6">
        <label
          class="md:col-span-4 font-semibold text-sm text-gray-700 dark:text-gray-300"
        >
          {{ 'PROFILE.AVATAR' | translate }}
        </label>
        <div class="md:col-span-8 space-y-2">
          <div
            *ngIf="!previewImageUrl"
            class="border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-md flex items-center justify-center h-32 w-32"
          >
            <label
              class="cursor-pointer flex flex-col items-center justify-center"
            >
              <input
                type="file"
                (change)="onFileSelected($event)"
                class="hidden"
              />
              <mat-icon class="text-gray-500 dark:text-gray-400"
                >image</mat-icon
              >
              <span class="text-xs text-gray-500 dark:text-gray-400 mt-1"
                >{{ 'PROFILE.UPLOAD' | translate }}</span
              >
            </label>
          </div>
          <div *ngIf="previewImageUrl" class="relative w-32">
            <img
              [src]="previewImageUrl"
              alt="Preview"
              class="rounded-md border dark:border-gray-700"
            />
            <button
              type="button"
              (click)="onDeleteImage()"
              class="absolute top-0 right-0 bg-white dark:bg-dark-800 border text-sm px-2 py-1 rounded-full shadow dark:border-gray-700"
              title="Remove image"
            >
              &times;
            </button>
          </div>
          <p class="text-xs text-gray-400 dark:text-gray-500">
            {{ 'PROFILE.ALLOWED_FILE_TYPES' | translate }}: png, jpg, jpeg
          </p>
        </div>
      </div>

      <!-- Full Name -->
      <div class="grid grid-cols-1 md:grid-cols-12 gap-6">
        <label
          class="md:col-span-4 font-semibold text-sm text-gray-700 dark:text-gray-300"
        >
          {{ 'PROFILE.FULL_NAME' | translate }}*
        </label>
        <div class="md:col-span-8 flex flex-col md:flex-row gap-4">
          <div class="flex-1 relative">
            <input
              type="text"
              id="firstName"
              placeholder="{{ 'PROFILE.FIRST_NAME' | translate }}"
              formControlName="firstName"
              class="form-input dark:bg-dark-800 dark:text-white dark:border-gray-700"
              [class.border-error-500]="isFieldInvalid('firstName')"
            />
            <div
              *ngIf="isFieldInvalid('firstName')"
              class="text-xs text-red-500 mt-1"
            >
              <div *ngIf="userForm.get('firstName')?.errors?.['required']">
               {{ 'PROFILE.FIRST_NAME_REQUIRED' | translate }}
              </div>
            </div>
          </div>

          <div class="flex-1 relative">
            <input
              type="text"
              id="lastName"
              placeholder="{{ 'PROFILE.LAST_NAME' | translate }}"
              formControlName="lastName"
              class="form-input dark:bg-dark-800 dark:text-white dark:border-gray-700"
              [class.border-error-500]="isFieldInvalid('lastName')"
            />
            <div
              *ngIf="isFieldInvalid('lastName')"
              class="text-xs text-red-500 mt-1"
            >
              <div *ngIf="userForm.get('lastName')?.errors?.['required']">
                {{ 'PROFILE.LAST_NAME_REQUIRED' | translate }}
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- Email -->
      <div class="grid grid-cols-1 md:grid-cols-12 gap-6">
        <label
          for="email"
          class="md:col-span-4 font-semibold text-sm text-gray-700 dark:text-gray-300"
        >
          {{ 'PROFILE.EMAIL_ADDRESS' | translate }} *
        </label>
        <div class="md:col-span-8 relative">
          <input
            id="email"
            name="email"
            type="email"
            autocomplete="email"
            formControlName="email"
            placeholder="{{ 'PROFILE.ENTER_EMAIL' | translate }}"
            class="form-input dark:bg-dark-800 dark:text-white dark:border-gray-700"
            [class.border-error-500]="isFieldInvalid('email')"
          />
        </div>
        <div
          *ngIf="isFieldInvalid('email')"
          class="form-error text-red-500 text-xs"
        >
          {{ getFieldError("email") }}
        </div>
      </div>

      <!-- Phone -->
      <div class="grid grid-cols-1 md:grid-cols-12 gap-6">
        <label
          class="md:col-span-4 font-semibold text-sm text-gray-700 dark:text-gray-300 flex items-center gap-2"
        >
          {{ 'PROFILE.CONTACT_PHONE' | translate }}
          <i
            class="ki-outline ki-information-5 text-gray-400 text-sm dark:text-gray-500"
            title="{{ 'PROFILE.PHONE_VERIFIED' | translate }}"
          ></i>
        </label>
        <div class="md:col-span-8 relative">
          <app-phone-input formControlName="phoneNumber"></app-phone-input>
          <div
            *ngIf="isFieldInvalid('phoneNumber')"
            class="text-xs text-red-500 mt-1"
          >
            <div *ngIf="userForm.get('phoneNumber')?.errors?.['pattern']">
              {{ 'PROFILE.INVALID_PHONE_FORMAT' | translate }}
            </div>
            <div *ngIf="userForm.get('phoneNumber')?.errors?.['minlength']">
              {{ 'PROFILE.PHONE_TOO_SHORT' | translate }}
            </div>
          </div>
        </div>
      </div>
      <div class="space-y-8" *ngIf="user?.type === 'vendor'">
        <!-- Company Name -->
        <div class="grid grid-cols-1 md:grid-cols-12 gap-6">
          <label
            class="md:col-span-4 font-semibold text-sm text-gray-700 dark:text-gray-300"
            >{{ 'PROFILE.COMPANY_NAME' | translate }}</label
          >
          <div class="md:col-span-8">
            <input
              type="text"
              formControlName="companyName"
              placeholder="{{ 'PROFILE.COMPANY_NAME' | translate }}"
              class="form-input dark:bg-dark-800 dark:text-white dark:border-gray-700"
              [class.border-error-500]="isFieldInvalid('companyName')"
            />
            <div
              *ngIf="isFieldInvalid('companyName')"
              class="text-xs text-red-500 mt-1"
            >
              {{ 'PROFILE.COMPANY_NAME_REQUIRED' | translate }}
            </div>
          </div>
        </div>

        <!-- Business Address -->
        <div class="grid grid-cols-1 md:grid-cols-12 gap-6">
          <label
            class="md:col-span-4 font-semibold text-sm text-gray-700 dark:text-gray-300"
            >{{ 'PROFILE.BUSINESS_ADDRESS' | translate }}</label
          >
          <div class="md:col-span-8">
            <input
              type="text"
              formControlName="businessAddress"
              placeholder="{{ 'PROFILE.BUSINESS_ADDRESS' | translate }}"
              class="form-input dark:bg-dark-800 dark:text-white dark:border-gray-700"
            />
          </div>
        </div>

        <!-- Contact Person -->
        <div class="grid grid-cols-1 md:grid-cols-12 gap-6">
          <label
            class="md:col-span-4 font-semibold text-sm text-gray-700 dark:text-gray-300"
            >{{ 'PROFILE.CONTACT_PERSON' | translate }}</label
          >
          <div class="md:col-span-8">
            <input
              type="text"
              formControlName="contactPerson"
              placeholder="{{ 'PROFILE.CONTACT_PERSON' | translate }}"
              class="form-input dark:bg-dark-800 dark:text-white dark:border-gray-700"
            />
          </div>
        </div>

        <!-- Business Description -->
        <div class="grid grid-cols-1 md:grid-cols-12 gap-6">
          <label
            class="md:col-span-4 font-semibold text-sm text-gray-700 dark:text-gray-300"
            >{{ 'PROFILE.BUSINESS_DESCRIPTION' | translate }}</label
          >
          <div class="md:col-span-8">
            <textarea
              formControlName="businessDescription"
              rows="4"
              placeholder="{{ 'PROFILE.BUSINESS_DESCRIPTION_PLACEHOLDER' | translate }}"
              class="form-input dark:bg-dark-800 dark:text-white dark:border-gray-700"
            ></textarea>
          </div>
        </div>

        <!-- Company Size & Years in Business -->
        <div class="grid grid-cols-1 md:grid-cols-12 gap-6">
          <label
            class="md:col-span-4 font-semibold text-sm text-gray-700 dark:text-gray-300"
          >
            {{ 'PROFILE.COMPANY_SIZE_YEARS' | translate }}
          </label>
          <div class="md:col-span-8 flex flex-col md:flex-row gap-4">
            <input
              type="text"
              formControlName="companySize"
              placeholder="{{ 'PROFILE.COMPANY_SIZE' | translate }}"
              class="form-input dark:bg-dark-800 dark:text-white dark:border-gray-700"
            />
            <input
              type="number"
              formControlName="yearsInBusiness"
              placeholder="{{ 'PROFILE.YEARS_IN_BUSINESS' | translate }}"
              class="form-input dark:bg-dark-800 dark:text-white dark:border-gray-700"
            />
          </div>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-12 gap-6">
          <label
            for="businessLicense"
            class="md:col-span-4 font-semibold text-sm text-gray-700 dark:text-gray-300"
          >
            {{ 'PROFILE.BUSINESS_LICENSE' | translate }}
          </label>
          <div class="md:col-span-8 flex flex-col md:flex-row gap-4">
            <div>
              <input
                id="businessLicense"
                name="businessLicense"
                type="file"
                accept=".pdf,.jpg,.jpeg,.png,.doc,.docx"
                (change)="onFileSelected($event)"
                class="form-input file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-primary-50 file:text-primary-700 hover:file:bg-primary-100 block w-full"
              />
              <p class="mt-1 text-xs text-secondary-500">
                {{ 'PROFILE.ALLOWED_FILE_TYPES' | translate }}: PDF, JPG, PNG, DOC, DOCX (Max 5MB)
              </p>
              <div
                *ngIf="selectedFileName"
                class="mt-2 text-sm text-secondary-600"
              >
                {{ 'PROFILE.SELECTED_FILE' | translate }}: {{ selectedFileName }}
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Footer Buttons -->
    <div
      class="flex justify-end gap-4 px-6 py-6 border-t border-gray-200 dark:border-dark-700"
    >
      <button
        type="reset"
        (click)="discardChanges()"
        [disabled]="!hasChanges()"
        class="px-4 py-2 text-sm rounded-md bg-gray-100 dark:bg-dark-700 hover:bg-gray-200 text-gray-800 dark:text-white disabled:opacity-50"
      >
        {{ 'PROFILE.DISCARD_CHANGES' | translate }}
      </button>
      <button
        type="submit"
        [disabled]="!hasChanges() || isSubmitting"
        class="px-4 py-2 text-sm rounded-md bg-blue-600 hover:bg-blue-700 text-white disabled:opacity-50 flex items-center"
      >
        <ng-container *ngIf="isSubmitting">
          <span class="flex items-center">
            {{ 'PROFILE.PLEASE_WAIT' | translate }}
            <span
              class="ml-2 w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"
            ></span>
          </span>
        </ng-container>
        <ng-container *ngIf="!isSubmitting"> {{ 'PROFILE.SAVE_CHANGES' | translate }} </ng-container>
      </button>
    </div>
  </form>
</div>
