<!-- Profile Details Card -->
<div
  *ngIf="successMessage"
  class="alert alert-success fade-in mb-5"
  role="alert"
>
  <div class="flex">
    <svg class="h-5 w-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
      <path
        fill-rule="evenodd"
        d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"
        clip-rule="evenodd"
      />
    </svg>
    <span>{{ successMessage }}</span>
  </div>
</div>
<div *ngIf="errorMessage" class="alert alert-error fade-in mb-5" role="alert">
  <div class="flex">
    <svg class="h-5 w-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
      <path
        fill-rule="evenodd"
        d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z"
        clip-rule="evenodd"
      />
    </svg>
    <span>{{ errorMessage }}</span>
  </div>
</div>
<div class="bg-white card shadow-md rounded-xl mb-10 dark:bg-dark-900">
  <!-- Card Header -->
  <div class="cursor-pointer px-6 pt-6" role="button">
    <div>
      <h3 class="text-lg font-bold text-gray-900 dark:text-white m-0">
        {{ 'PROFILE.PROFILE_DETAILS' | translate }}
      </h3>
    </div>
  </div>

  <!-- Form -->
  <form class="pt-6" [formGroup]="userForm" (ngSubmit)="onSubmit()">
    <div
      class="border-t border-gray-200 dark:border-dark-700 px-6 py-8 space-y-8"
    >
      <!-- Avatar Upload -->
      <div class="grid grid-cols-1 md:grid-cols-12 items-start gap-6">
        <label
          class="md:col-span-4 font-semibold text-sm text-gray-700 dark:text-gray-300"
        >
          {{ 'PROFILE.AVATAR' | translate }}
        </label>
        <div class="md:col-span-8 space-y-2">
          <!-- Upload Button Placeholder -->
          <label
            *ngIf="!previewImageUrl"
            for="avatar-upload"
            class="cursor-pointer border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-md flex flex-col items-center justify-center h-32 w-32"
          >
            <input
              id="avatar-upload"
              type="file"
              (change)="onFileSelected($event, 'avatar')"
              class="hidden"
              accept="image/*"
            />
            <i
              class="ki-outline ki-picture text-base text-gray-500 dark:text-gray-400"
            ></i>
            <span class="text-xs text-gray-500 dark:text-gray-400 mt-3">
              {{ 'PROFILE.UPLOAD' | translate }}
            </span>
          </label>

          <!-- Image Preview -->
          <div *ngIf="previewImageUrl" class="relative w-32">
            <img
              [src]="previewImageUrl"
              alt="Preview"
              (error)="onImageLoadError()"
              class="rounded-md border dark:border-gray-700"
            />
            <button
              type="button"
              (click)="onDeleteImage()"
              class="absolute top-0 right-0 bg-white dark:bg-dark-800 border text-sm px-2 py-1 rounded-full shadow dark:border-gray-700"
              title="Remove image"
            >
              &times;
            </button>
          </div>

          <!-- Hint Text -->
          <p class="text-xs text-gray-400 dark:text-gray-500">
            {{ 'PROFILE.ALLOWED_FILE_TYPES' | translate }}: png, jpg, jpeg
          </p>
        </div>
      </div>

      <!-- Full Name -->
      <div class="grid grid-cols-1 md:grid-cols-12 gap-6">
        <label
          class="md:col-span-4 font-semibold text-sm text-gray-700 dark:text-gray-300"
        >
          {{ 'PROFILE.FULL_NAME' | translate }}*
        </label>
        <div class="md:col-span-8 flex flex-col md:flex-row gap-4">
          <div class="flex-1 relative">
            <input
              type="text"
              id="firstName"
              placeholder="{{ 'PROFILE.FIRST_NAME' | translate }}"
              formControlName="firstName"
              class="form-input dark:bg-dark-800 dark:text-white dark:border-gray-700"
              [class.border-error-500]="isFieldInvalid('firstName')"
            />
            <div
              *ngIf="isFieldInvalid('firstName')"
              class="text-xs text-red-500 mt-1"
            >
              <div *ngIf="userForm.get('firstName')?.errors?.['required']">
                {{ 'PROFILE.FIRST_NAME_REQUIRED' | translate }}
              </div>
            </div>
          </div>
          <div class="flex-1 relative">
            <input
              type="text"
              id="lastName"
              placeholder="{{ 'PROFILE.LAST_NAME' | translate }}"
              formControlName="lastName"
              class="form-input dark:bg-dark-800 dark:text-white dark:border-gray-700"
              [class.border-error-500]="isFieldInvalid('lastName')"
            />
            <div
              *ngIf="isFieldInvalid('lastName')"
              class="text-xs text-red-500 mt-1"
            >
              <div *ngIf="userForm.get('lastName')?.errors?.['required']">
                {{ 'PROFILE.LAST_NAME_REQUIRED' | translate }}
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Email -->
      <div class="grid grid-cols-1 md:grid-cols-12 gap-6">
        <label
          for="email"
          class="md:col-span-4 font-semibold text-sm text-gray-700 dark:text-gray-300"
        >
          {{ 'PROFILE.EMAIL_ADDRESS' | translate }} *
        </label>
        <div class="md:col-span-8 relative">
          <input
            type="email"
            formControlName="email"
            placeholder="{{ 'PROFILE.ENTER_EMAIL' | translate }}"
            class="form-input dark:bg-dark-800 dark:text-white dark:border-gray-700"
            [class.border-error-500]="isFieldInvalid('email')"
          />
        </div>
        <div
          *ngIf="isFieldInvalid('email')"
          class="form-error text-red-500 text-xs"
        >
          {{ getFieldError("email") }}
        </div>
      </div>

      <!-- Phone -->
      <div class="grid grid-cols-1 md:grid-cols-12 gap-6">
        <label
          class="md:col-span-4 font-semibold text-sm text-gray-700 dark:text-gray-300 flex items-center gap-2"
        >
          {{ 'PROFILE.PHONE_NUMBER' | translate }}
        </label>
        <div class="md:col-span-8 relative">
          <input
            type="tel"
            formControlName="phoneNumber"
            placeholder="{{ 'PROFILE.CONTACT_PERSON_PHONE' | translate }}"
            class="form-input dark:bg-dark-800 dark:text-white dark:border-gray-700"
            [class.border-error-500]="isFieldInvalid('phoneNumber')"
            (input)="onPhoneInput($event, 'phoneNumber')"
            maxlength="17"
          />
          <div
            *ngIf="isFieldInvalid('phoneNumber')"
            class="form-error text-red-500 text-xs"
          >
            {{ getFieldError("phoneNumber") }}
          </div>
          <div class="md:col-span-8">
            <p class="text-xs text-gray-500 mt-1">
              {{ 'PROFILE.PHONE_FORMAT_HINT' | translate }}
            </p>
          </div>
        </div>
      </div>

      <!-- Company Details Section - Only for Vendors -->
      <div class="space-y-8" *ngIf="user?.type === 'Vendor'">
        <div class="border-t border-gray-200 dark:border-dark-700 pt-8">
          <h4 class="text-lg font-semibold text-gray-900 dark:text-white mb-6">
            {{ 'PROFILE.COMPANY_DETAILS' | translate }}
          </h4>
        </div>

        <!-- Company Name -->
        <div class="grid grid-cols-1 md:grid-cols-12 gap-6">
          <label
            class="md:col-span-4 font-semibold text-sm text-gray-700 dark:text-gray-300"
          >
            {{ 'PROFILE.COMPANY_NAME' | translate }} *
          </label>
          <div class="md:col-span-8">
            <input
              type="text"
              formControlName="companyName"
              placeholder="{{ 'PROFILE.COMPANY_NAME' | translate }}"
              class="form-input dark:bg-dark-800 dark:text-white dark:border-gray-700"
              [class.border-error-500]="isFieldInvalid('companyName')"
            />
            <div
              *ngIf="isFieldInvalid('companyName')"
              class="text-xs text-red-500 mt-1"
            >
              {{ 'PROFILE.COMPANY_NAME_REQUIRED' | translate }}
            </div>
          </div>
        </div>

        <!-- Contact Person Details -->
        <div class="grid grid-cols-1 md:grid-cols-12 gap-6">
          <label
            class="md:col-span-4 font-semibold text-sm text-gray-700 dark:text-gray-300"
          >
            {{ 'PROFILE.CONTACT_PERSON_NAME' | translate }} *
          </label>
          <div class="md:col-span-8 flex flex-col md:flex-row gap-4">
            <div class="flex-1">
              <input
                type="text"
                formControlName="contactPersonFirstName"
                placeholder="{{ 'PROFILE.CONTACT_FIRST_NAME' | translate }}"
                class="form-input dark:bg-dark-800 dark:text-white dark:border-gray-700"
                [class.border-error-500]="isFieldInvalid('contactPersonFirstName')"
              />
              <div
                *ngIf="isFieldInvalid('contactPersonFirstName')"
                class="text-xs text-red-500 mt-1"
              >
                {{ 'PROFILE.CONTACT_FIRST_NAME_REQUIRED' | translate }}
              </div>
            </div>
            <div class="flex-1">
              <input
                type="text"
                formControlName="contactPersonLastName"
                placeholder="{{ 'PROFILE.CONTACT_LAST_NAME' | translate }}"
                class="form-input dark:bg-dark-800 dark:text-white dark:border-gray-700"
                [class.border-error-500]="isFieldInvalid('contactPersonLastName')"
              />
              <div
                *ngIf="isFieldInvalid('contactPersonLastName')"
                class="text-xs text-red-500 mt-1"
              >
                {{ 'PROFILE.CONTACT_LAST_NAME_REQUIRED' | translate }}
              </div>
            </div>
          </div>
        </div>

        <!-- Contact Person Email -->
        <div class="grid grid-cols-1 md:grid-cols-12 gap-6">
          <label
            class="md:col-span-4 font-semibold text-sm text-gray-700 dark:text-gray-300"
          >
            {{ 'PROFILE.CONTACT_PERSON_EMAIL' | translate }} *
          </label>
          <div class="md:col-span-8">
            <input
              type="email"
              formControlName="contactPersonEmail"
              placeholder="{{ 'PROFILE.CONTACT_PERSON_EMAIL' | translate }}"
              class="form-input dark:bg-dark-800 dark:text-white dark:border-gray-700"
              [class.border-error-500]="isFieldInvalid('contactPersonEmail')"
            />
            <div
              *ngIf="isFieldInvalid('contactPersonEmail')"
              class="text-xs text-red-500 mt-1"
            >
              {{ getFieldError('contactPersonEmail') }}
            </div>
          </div>
        </div>

        <!-- Contact Person Phone -->
        <div class="grid grid-cols-1 md:grid-cols-12 gap-6">
          <label
            class="md:col-span-4 font-semibold text-sm text-gray-700 dark:text-gray-300"
          >
            {{ 'PROFILE.CONTACT_PERSON_PHONE' | translate }} *
          </label>
          <div class="md:col-span-8">
            <input
              type="tel"
              formControlName="contactPersonPhone"
              placeholder="{{ 'PROFILE.CONTACT_PERSON_PHONE' | translate }}"
              class="form-input dark:bg-dark-800 dark:text-white dark:border-gray-700"
              [class.border-error-500]="isFieldInvalid('contactPersonPhone')"
              (input)="onPhoneInput($event, 'contactPersonPhone')"
              maxlength="17"
            />
            <div
              *ngIf="isFieldInvalid('contactPersonPhone')"
              class="form-error text-red-500 text-xs"
            >
              {{ getFieldError("contactPersonPhone") }}
            </div>
            <div class="md:col-span-8">
              <p class="text-xs text-gray-500 mt-1">
                {{ 'PROFILE.PHONE_FORMAT_HINT' | translate }}
              </p>
            </div>
          </div>
        </div>

        <!-- Business Description -->
        <div class="grid grid-cols-1 md:grid-cols-12 gap-6">
          <label
            class="md:col-span-4 font-semibold text-sm text-gray-700 dark:text-gray-300"
          >
            {{ 'PROFILE.BUSINESS_DESCRIPTION' | translate }}
          </label>
          <div class="md:col-span-8">
            <textarea
              formControlName="businessDescription"
              rows="4"
              placeholder="{{ 'PROFILE.BUSINESS_DESCRIPTION_PLACEHOLDER' | translate }}"
              class="form-input dark:bg-dark-800 dark:text-white dark:border-gray-700"
            ></textarea>
          </div>
        </div>

        <!-- Business Address -->
        <div class="grid grid-cols-1 md:grid-cols-12 gap-6">
          <label
            class="md:col-span-4 font-semibold text-sm text-gray-700 dark:text-gray-300"
          >
            {{ 'PROFILE.BUSINESS_ADDRESS' | translate }}
          </label>
          <div class="md:col-span-8">
            <input
              type="text"
              formControlName="businessAddress"
              placeholder="{{ 'PROFILE.BUSINESS_ADDRESS' | translate }}"
              class="form-input dark:bg-dark-800 dark:text-white dark:border-gray-700"
            />
          </div>
        </div>

        <!-- Location Coordinates (Hidden fields or map integration) -->
        <div
          class="grid grid-cols-1 md:grid-cols-12 gap-6"
          style="display: none"
        >
          <div class="md:col-span-8 md:col-start-5 flex gap-4">
            <input
              type="number"
              formControlName="latitudeAddress"
              placeholder="{{ 'PROFILE.LATITUDE' | translate }}"
              class="form-input dark:bg-dark-800 dark:text-white dark:border-gray-700"
              step="any"
            />
            <input
              type="number"
              formControlName="longitudeAddress"
              placeholder="{{ 'PROFILE.LONGITUDE' | translate }}"
              class="form-input dark:bg-dark-800 dark:text-white dark:border-gray-700"
              step="any"
            />
          </div>
        </div>

        <!-- Operating Radius -->
        <div class="grid grid-cols-1 md:grid-cols-12 gap-6">
          <label
            class="md:col-span-4 font-semibold text-sm text-gray-700 dark:text-gray-300"
          >
            {{ 'PROFILE.OPERATING_RADIUS' | translate }}
          </label>
          <div class="md:col-span-8">
            <div class="relative">
              <input
                type="number"
                formControlName="operatingRadius"
                placeholder="{{ 'PROFILE.OPERATING_RADIUS_PLACEHOLDER' | translate }}"
                class="form-input dark:bg-dark-800 dark:text-white dark:border-gray-700"
                step="0.1"
              />
              <span
                class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 text-sm"
                >km</span
              >
            </div>
          </div>
        </div>

        <!-- Company Size -->
        <div class="grid grid-cols-1 md:grid-cols-12 gap-6">
          <label
            class="md:col-span-4 font-semibold text-sm text-gray-700 dark:text-gray-300"
          >
            {{ 'PROFILE.COMPANY_SIZE' | translate }}
          </label>
          <div class="md:col-span-8">
            <select formControlName="companySize" class="form-select">
              <option [ngValue]="null" disabled selected>
                {{ 'PROFILE.SELECT_COMPANY_SIZE' | translate }}
              </option>
              <option *ngFor="let size of companySizes" [value]="size.id">
                {{ size.name }}
              </option>
            </select>
          </div>
        </div>
        <!-- Business Certificate -->
        <div class="grid grid-cols-1 md:grid-cols-12 gap-6">
          <label
            for="businessCertificate"
            class="md:col-span-4 font-semibold text-sm text-gray-700 dark:text-gray-300"
          >
            {{ 'PROFILE.BUSINESS_CERTIFICATE' | translate }}
          </label>
          <div class="md:col-span-8">
            <!-- Drag & Drop Zone -->
            <div
              class="relative border-2 border-dashed rounded-lg p-6 text-center transition-colors duration-200"
              [ngClass]="{
        'border-primary-400 bg-primary-50 dark:bg-primary-900/20': isDragOver,
        'border-gray-300 dark:border-gray-600 hover:border-primary-300 dark:hover:border-primary-400': !isDragOver && !selectedCertificate,
        'border-green-400 bg-green-50 dark:bg-green-900/20': selectedCertificate
      }"
              (dragover)="onDragOver($event)"
              (dragleave)="onDragLeave($event)"
              (drop)="onDrop($event)"
              (click)="!selectedCertificate && fileInput.click()"
              [style.cursor]="!selectedCertificate ? 'pointer' : 'default'"
            >
              <!-- Hidden file input -->
              <input
                #fileInput
                type="file"
                class="hidden"
                formControlName="certificateUrl"
                accept=".pdf,.jpg,.jpeg,.png,.doc,.docx"
                (change)="onFileSelected($event, 'certificate')"
              />

              <!-- Upload State -->
              <div *ngIf="!selectedCertificate" class="space-y-4">
                <div class="mx-auto w-12 h-12 text-gray-400 dark:text-gray-500">
                  <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"
                    />
                  </svg>
                </div>
                <div>
                  <p class="text-sm text-gray-600 dark:text-gray-400">
                    <span
                      class="font-medium text-primary-600 dark:text-primary-400"
                    >
                      {{ 'PROFILE.CLICK_TO_UPLOAD' | translate }}
                    </span>
                    {{ 'PROFILE.OR_DRAG_AND_DROP' | translate }}
                  </p>
                  <p class="text-xs text-gray-500 dark:text-gray-500 mt-1">
                    {{ 'PROFILE.ALLOWED_FILE_TYPES' | translate }}: PDF, JPG,
                    PNG, DOC, DOCX (Max 5MB)
                  </p>
                </div>
              </div>

              <!-- File Selected State -->
              <div *ngIf="selectedCertificate" class="space-y-3">
                <div class="flex items-center justify-center space-x-3">
                  <!-- File Icon -->
                  <div class="flex-shrink-0">
                    <div
                      class="w-10 h-10 rounded-lg flex items-center justify-center"
                      [ngClass]="{
                'bg-red-100 text-red-600 dark:bg-red-900/20 dark:text-red-400': getFileType(selectedFileName!) === 'pdf',
                'bg-blue-100 text-blue-600 dark:bg-blue-900/20 dark:text-blue-400': getFileType(selectedFileName!) === 'doc',
                'bg-green-100 text-green-600 dark:bg-green-900/20 dark:text-green-400': getFileType(selectedFileName!) === 'image'
              }"
                    >
                      <!-- PDF Icon -->
                      <svg
                        *ngIf="getFileType(selectedFileName!) === 'pdf'"
                        class="w-5 h-5"
                        fill="currentColor"
                        viewBox="0 0 24 24"
                      >
                        <path
                          d="M12,2A3,3 0 0,1 15,5V7H20.5A2.5,2.5 0 0,1 23,9.5V18.5A2.5,2.5 0 0,1 20.5,21H3.5A2.5,2.5 0 0,1 1,18.5V9.5A2.5,2.5 0 0,1 3.5,7H9V5A3,3 0 0,1 12,2M12,4A1,1 0 0,0 11,5V7H13V5A1,1 0 0,0 12,4Z"
                        />
                      </svg>
                      <!-- DOC Icon -->
                      <svg
                        *ngIf="getFileType(selectedFileName!) === 'doc'"
                        class="w-5 h-5"
                        fill="currentColor"
                        viewBox="0 0 24 24"
                      >
                        <path
                          d="M6,2A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2H6M6,4H13V9H18V20H6V4Z"
                        />
                      </svg>
                      <!-- Image Icon -->
                      <svg
                        *ngIf="getFileType(selectedFileName!) === 'image'"
                        class="w-5 h-5"
                        fill="currentColor"
                        viewBox="0 0 24 24"
                      >
                        <path
                          d="M8.5,13.5L11,16.5L14.5,12L19,18H5M21,19V5C21,3.89 20.1,3 19,3H5A2,2 0 0,0 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19Z"
                        />
                      </svg>
                    </div>
                  </div>

                  <!-- File Info -->
                  <div class="flex-1 min-w-0 text-left">
                    <p
                      class="text-sm font-medium text-gray-900 dark:text-gray-100 truncate"
                    >
                      {{ selectedFileName }}
                    </p>
                    <p class="text-xs text-gray-500 dark:text-gray-400">
                      {{ getFileSize(selectedCertificate) }}
                    </p>
                  </div>
                </div>

                <!-- Remove Button -->
                <div class="pt-2">
                  <button
                    type="button"
                    (click)="onRemoveCertificate($event)"
                    class="inline-flex items-center px-3 py-1.5 text-xs font-medium text-red-600 dark:text-red-400 bg-red-50 dark:bg-red-900/20 hover:bg-red-100 dark:hover:bg-red-900/30 rounded-md transition-colors duration-200"
                  >
                    <svg
                      class="w-4 h-4 mr-1"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"
                      />
                    </svg>
                    {{ 'PROFILE.REMOVE_FILE' | translate }}
                  </button>
                </div>
              </div>

              <!-- Drag overlay -->
              <div
                *ngIf="isDragOver"
                class="absolute inset-0 bg-primary-50 dark:bg-primary-900/30 border-2 border-primary-400 rounded-lg flex items-center justify-center"
              >
                <div class="text-center">
                  <svg
                    class="mx-auto w-8 h-8 text-primary-500 mb-2"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"
                    />
                  </svg>
                  <p
                    class="text-sm font-medium text-primary-600 dark:text-primary-400"
                  >
                    {{ 'PROFILE.DROP_FILE_HERE' | translate }}
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer Buttons -->
    <div
      class="flex justify-end gap-4 px-6 py-6 border-t border-gray-200 dark:border-dark-700"
    >
      <button
        type="button"
        (click)="discardChanges()"
        [disabled]="!isFormChanged"
        class="px-4 py-2 text-sm rounded-md bg-gray-100 dark:bg-dark-700 hover:bg-gray-200 text-gray-800 dark:text-white disabled:opacity-50"
      >
        {{ 'PROFILE.DISCARD_CHANGES' | translate }}
      </button>
      <button
        type="submit"
        [disabled]="!userForm.valid || !isFormChanged || isSubmitting"
        class="px-4 py-2 text-sm rounded-md bg-blue-600 hover:bg-blue-700 text-white disabled:opacity-50 flex items-center"
      >
        <ng-container *ngIf="isSubmitting">
          <span class="flex items-center">
            {{ 'PROFILE.PLEASE_WAIT' | translate }}
            <span
              class="ml-2 w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"
            ></span>
          </span>
        </ng-container>
        <ng-container *ngIf="!isSubmitting">
          {{ 'PROFILE.SAVE_CHANGES' | translate }}
        </ng-container>
      </button>
    </div>
  </form>
</div>
<app-profile-settings-reset-password></app-profile-settings-reset-password>
